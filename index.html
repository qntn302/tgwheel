<!DOCTYPE html>
<html>
<head>
    <title>301secrets Wheel of Drops</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 100%);
            color: white;
            text-align: center;
            padding: 20px;
            font-family: 'Segoe UI', Arial, sans-serif;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .container {
            max-width: 500px;
            width: 100%;
            padding: 20px;
        }
        
        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        .lang-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 60px;
        }
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .lang-btn.active {
            background: #ff7f00;
            border-color: #ff7f00;
        }
        
        h1 {
            color: #ff7f00;
            margin-bottom: 10px;
            font-size: 28px;
            margin-top: 40px;
        }
        .subtitle {
            color: #aaa;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        /* Drop Pace –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
        .drop-pace-indicator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .drop-pace-label {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .drop-pace-status {
            font-size: 20px;
            font-weight: bold;
            color: #ff7f00;
        }
        .drop-pace-status.low { color: #e74c3c; }
        .drop-pace-status.stable { color: #f1c40f; }
        .drop-pace-status.high { color: #2ecc71; }
        .drop-pace-status.peak { color: #9b59b6; }
        .info-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –ö–æ–ª–µ—Å–æ */
        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 0 auto 40px;
        }
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff7f00 0deg 36deg,
                #3498db 36deg 54deg,
                #2ecc71 54deg 72deg,
                #9b59b6 72deg 84deg,
                #e74c3c 84deg 90deg,
                #f1c40f 90deg 104.4deg,
                #1abc9c 104.4deg 115.2deg,
                #e67e22 115.2deg 118.8deg,
                #34495e 118.8deg 122.4deg,
                #d35400 122.4deg 123.6deg,
                #1a1a1a 123.6deg 360deg
            );
            transition: transform 5.5s cubic-bezier(0.2, 0.8, 0.3, 0.99);
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 8px solid #2d1b69;
        }
        .pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 50px;
            background: #ff7f00;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            z-index: 10;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5));
        }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞ */
        .spin-btn {
            background: linear-gradient(135deg, #ff7f00 0%, #ff5500 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 25px 0;
            box-shadow: 0 8px 20px rgba(255, 127, 0, 0.4);
            transition: all 0.3s;
            letter-spacing: 1px;
        }
        .spin-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(255, 127, 0, 0.6);
        }
        .spin-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* –†–µ–∑—É–ª—å—Ç–∞—Ç */
        .result {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff7f00;
            display: none;
            backdrop-filter: blur(10px);
        }
        .prize-name {
            font-size: 24px;
            color: #ff7f00;
            margin: 15px 0;
            font-weight: bold;
        }
        .prize-desc {
            color: #ccc;
            font-size: 15px;
            margin: 15px 0 25px;
            line-height: 1.5;
        }
        .claim-btn, .subscribe-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            display: none;
            transition: all 0.3s;
            margin: 5px;
        }
        .claim-btn:hover, .subscribe-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .cooldown-info {
            color: #ff7f00;
            font-size: 13px;
            margin-top: 8px;
            display: none;
            font-weight: bold;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 127, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 127, 0, 0.8); }
        }
        .spin-btn:not(:disabled) {
            animation: glow 2s infinite;
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="lang-btn active" onclick="setLanguage('ru')">RU</button>
        <button class="lang-btn" onclick="setLanguage('en')">EN</button>
    </div>
    
    <div class="container">
        <h1 id="title">üé° Wheel of Drops</h1>
        <p class="subtitle" id="subtitle">Spin the wheel and see what drops today</p>
        
        <!-- Drop Pace –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä -->
        <div class="drop-pace-indicator">
            <div class="drop-pace-label">
                Drop Pace
                <button class="info-btn" onclick="showDropPaceInfo()" title="Info">‚ÑπÔ∏è</button>
            </div>
            <div class="drop-pace-status" id="dropPaceStatus">Stable</div>
        </div>
        
        <div class="wheel-container">
            <div class="pointer"></div>
            <div class="wheel" id="wheel"></div>
        </div>
        
        <button class="spin-btn" id="spinBtn" onclick="checkSpinAvailability()">üé° Spin the wheel</button>
        <div class="cooldown-info" id="cooldownInfo"></div>
        
        <div class="result" id="result">
            <div id="resultTitle"></div>
            <div class="prize-name" id="prizeName"></div>
            <div class="prize-desc" id="prizeDesc"></div>
            <button class="claim-btn" id="claimBtn" onclick="claimPrize()" style="display: none;"></button>
            <button class="subscribe-btn" id="subscribeBtn" onclick="openSubscribeChannels()" style="display: none;"></button>
        </div>
    </div>
    
    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const CHANNELS = ["@quanteen", "@quanteenhub301"];
        
        // ==================== –ü–†–ò–ó–´ ====================
        const prizeTypes = {
            empty: { name: "Nothing this time", name_ru: "–ü–æ–∫–∞ –Ω–µ —Å–µ–≥–æ–¥–Ω—è" },
            content: { name: "Content reward", name_ru: "–ö–æ–Ω—Ç–µ–Ω—Ç" },
            discount_10: { name: "10% discount", name_ru: "–°–∫–∏–¥–∫–∞ 10%" },
            discount_15: { name: "15% discount", name_ru: "–°–∫–∏–¥–∫–∞ 15%" },
            discount_20: { name: "20% discount", name_ru: "–°–∫–∏–¥–∫–∞ 20%" },
            access_7: { name: "7 days full access", name_ru: "7 –¥–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞" },
            access_30: { name: "30 days full access", name_ru: "30 –¥–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞" }
        };
        
        // ==================== –í–ï–†–û–Ø–¢–ù–û–°–¢–ò –ü–û DROP PACE ====================
        function getProbabilities(dropPace) {
            if (dropPace >= 0 && dropPace <= 2) {
                // LOW
                return {
                    empty: 65,
                    content: 20,
                    discount_10: 6,
                    discount_15: 3,
                    discount_20: 1,
                    access_7: 3,
                    access_30: 2
                };
            } else if (dropPace >= 3 && dropPace <= 8) {
                // STABLE (3-5) –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ (6-8)
                return {
                    empty: 50,
                    content: 30,
                    discount_10: 8,
                    discount_15: 5,
                    discount_20: 2,
                    access_7: 3,
                    access_30: 2
                };
            } else {
                // PEAK (9-10)
                return {
                    empty: 30,
                    content: 40,
                    discount_10: 10,
                    discount_15: 7,
                    discount_20: 3,
                    access_7: 6,
                    access_30: 4
                };
            }
        }
        
        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentLang = 'en';
        let isSpinning = false;
        let currentPrize = null;
        let userData = {
            dropPace: 0,
            lastSpinTime: null,
            fullAccessCooldown: null,
            hasWonFullAccess: false,
            pendingReward: null
        };
        
        // ==================== –ü–ï–†–ï–í–û–î–´ ====================
        const translations = {
            ru: {
                title: "üé° –ö–æ–ª–µ—Å–æ –Ω–∞–≥—Ä–∞–¥",
                subtitle: "–ö—Ä—É—Ç–∏ –∫–æ–ª–µ—Å–æ –∏ —Å–º–æ—Ç—Ä–∏ —á—Ç–æ –≤—ã–ø–∞–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è",
                spinBtn: "üé° –ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ",
                cooldown: "–ü–æ–¥–æ–∂–¥–∏ –µ—â—ë {hours} —á–∞—Å–æ–≤",
                dropPaceLow: "Low",
                dropPaceStable: "Stable",
                dropPaceHigh: "High",
                dropPacePeak: "Peak",
                dropPaceInfo: "Drop Pace –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–≤–æ—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n\n–ë—É–¥—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å —à–∞–Ω—Å—ã\n\n–†–µ–¥–∫–∏–µ –Ω–∞–≥—Ä–∞–¥—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç —Ç–µ–º–ø",
                // –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–∞–≥—Ä–∞–¥
                emptyMsg: "–ü–æ–∫–∞ –Ω–µ —Å–µ–≥–æ–¥–Ω—è\n\n–¢–≤–æ–π Drop Pace –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞—Å—Ç–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞–≤—Ç—Ä–∞",
                contentMsg: "–ù–∞–≥—Ä–∞–¥–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞\n\n–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–ª—å–∫–æ —á—Ç–æ –≤—ã–ø–∞–ª üëá\n\n–¢–∞–∫–∏–µ –≤–µ—â–∏ –≤—ã–ø–∞–¥–∞—é—Ç –Ω–∞–º–Ω–æ–≥–æ —á–∞—â–µ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –≥—Ä—É–ø–ø—ã",
                discountMsg: "–¢—ã –ø–æ–ª—É—á–∏–ª —Å–∫–∏–¥–∫—É {discount}%\n\n–ò—Å–ø–æ–ª—å–∑—É–π –µ—ë –¥–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω—É—é –≥—Ä—É–ø–ø—É\n\n–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è",
                access7Msg: "–¢—ã –ø–æ–ª—É—á–∏–ª 7 –¥–Ω–µ–π –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n\n–ò—Å—Å–ª–µ–¥—É–π –≤—Å—ë –≤–Ω—É—Ç—Ä–∏ ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç, —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ",
                access30Msg: "–†–µ–¥–∫–∏–π –¥—Ä–æ–ø\n\n–¢—ã –ø–æ–ª—É—á–∏–ª 30 –¥–Ω–µ–π –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n\n–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ –≤—Ä–µ–º—è —Å —É–º–æ–º",
                lockedMsg: "–¢—ã –ø–æ–ª—É—á–∏–ª –Ω–∞–≥—Ä–∞–¥—É ‚Äî –Ω–æ –æ–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞\n\n–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",
                subscribeBtn: "‚¨áÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",
                claimBtn: "ü™á –ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑"
            },
            en: {
                title: "üé° Wheel of Drops",
                subtitle: "Spin the wheel and see what drops today",
                spinBtn: "üé° Spin the wheel",
                cooldown: "Wait {hours} more hours",
                dropPaceLow: "Low",
                dropPaceStable: "Stable",
                dropPaceHigh: "High",
                dropPacePeak: "Peak",
                dropPaceInfo: "Drop Pace reflects your activity\n\nStay consistent to increase your chances\n\nRare rewards reset the pace",
                // –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–∞–≥—Ä–∞–¥
                emptyMsg: "Nothing this time\n\nYour Drop Pace keeps building ‚Äî come back tomorrow",
                contentMsg: "Drop unlocked\n\nExclusive content just landed üëá\n\nThis kind of stuff drops way more often inside the private group",
                discountMsg: "You unlocked a {discount}% discount\n\nUse it to join the private group\n\nThe code is valid for a limited time",
                access7Msg: "You unlocked 7 days of full access\n\nExplore everything inside ‚Äî content, workflows and community",
                access30Msg: "Rare drop\n\nYou unlocked 30 days of full access\n\nUse this time wisely",
                lockedMsg: "You got a reward ‚Äî but it's locked\n\nSubscribe to the required channels to unlock it",
                subscribeBtn: "‚¨áÔ∏è Subscribe & unlock",
                claimBtn: "ü™á Claim prize"
            }
        };
        
        // ==================== –§–£–ù–ö–¶–ò–ò –Ø–ó–´–ö–ê ====================
        function setLanguage(lang) {
            currentLang = lang;
            updateTexts();
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === lang.toUpperCase()) {
                    btn.classList.add('active');
                }
            });
            
            localStorage.setItem('wheel_lang', lang);
        }
        
        function updateTexts() {
            const t = translations[currentLang];
            document.getElementById('title').textContent = t.title;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('spinBtn').textContent = t.spinBtn;
            updateDropPaceDisplay();
        }
        
        function updateDropPaceDisplay() {
            const t = translations[currentLang];
            const statusEl = document.getElementById('dropPaceStatus');
            const pace = userData.dropPace;
            
            statusEl.className = 'drop-pace-status';
            if (pace >= 0 && pace <= 2) {
                statusEl.textContent = t.dropPaceLow;
                statusEl.classList.add('low');
            } else if (pace >= 3 && pace <= 5) {
                statusEl.textContent = t.dropPaceStable;
                statusEl.classList.add('stable');
            } else if (pace >= 6 && pace <= 8) {
                statusEl.textContent = t.dropPaceHigh;
                statusEl.classList.add('high');
            } else {
                statusEl.textContent = t.dropPacePeak;
                statusEl.classList.add('peak');
            }
        }
        
        function showDropPaceInfo() {
            const t = translations[currentLang];
            alert(t.dropPaceInfo);
        }
        
        // ==================== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ====================
        async function loadUserData() {
            if (typeof Telegram === 'undefined' || !Telegram.WebApp) {
                // –î–ª—è —Ç–µ—Å—Ç–∞
                userData = {
                    dropPace: 5,
                    lastSpinTime: null,
                    fullAccessCooldown: null,
                    hasWonFullAccess: false,
                    pendingReward: null
                };
                updateDropPaceDisplay();
                return;
            }
            
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É –±–æ—Ç–∞
                const user = Telegram.WebApp.initDataUnsafe.user;
                if (user) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    Telegram.WebApp.sendData(JSON.stringify({
                        action: "get_user_data",
                        user_id: user.id
                    }));
                    
                    // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º
                    // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage –∫–∞–∫ –∫—ç—à
                    const cached = localStorage.getItem('wheel_user_data');
                    if (cached) {
                        try {
                            const parsed = JSON.parse(cached);
                            userData = {
                                dropPace: parsed.dropPace || 0,
                                lastSpinTime: parsed.lastSpinTime ? new Date(parsed.lastSpinTime).getTime() : null,
                                fullAccessCooldown: parsed.fullAccessCooldown,
                                hasWonFullAccess: parsed.hasWonFullAccess || false,
                                pendingReward: parsed.pendingReward
                            };
                        } catch (e) {
                            userData = {
                                dropPace: 0,
                                lastSpinTime: null,
                                fullAccessCooldown: null,
                                hasWonFullAccess: false,
                                pendingReward: null
                            };
                        }
                    } else {
                        userData = {
                            dropPace: 0,
                            lastSpinTime: null,
                            fullAccessCooldown: null,
                            hasWonFullAccess: false,
                            pendingReward: null
                        };
                    }
                }
                updateDropPaceDisplay();
            } catch (e) {
                console.error('Error loading user data:', e);
            }
        }
        
        // ==================== –ü–†–û–í–ï–†–ö–ê –ü–û–î–ü–ò–°–ö–ò ====================
        async function checkSubscriptions() {
            if (typeof Telegram === 'undefined' || !Telegram.WebApp) {
                return true; // –î–ª—è —Ç–µ—Å—Ç–∞
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—É–¥–µ—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–∏–∑–∞
            // –ó–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º true, —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ handle_web_app_data
            return true;
        }
        
        // ==================== –§–£–ù–ö–¶–ò–ò –ö–û–õ–ï–°–ê ====================
        function checkSpinAvailability() {
            if (isSpinning) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º pending reward
            if (userData.pendingReward) {
                showPendingReward();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–ª–¥–∞—É–Ω (24 —á–∞—Å–∞)
            if (userData.lastSpinTime) {
                const hoursPassed = (Date.now() - userData.lastSpinTime) / (1000 * 60 * 60);
                if (hoursPassed < 24) {
                    const hoursLeft = Math.ceil(24 - hoursPassed);
                    const t = translations[currentLang];
                    document.getElementById('cooldownInfo').textContent = 
                        t.cooldown.replace('{hours}', hoursLeft);
                    document.getElementById('cooldownInfo').style.display = 'block';
                    return;
                }
            }
            
            document.getElementById('cooldownInfo').style.display = 'none';
            spinWheel();
        }
        
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            
            const spinBtn = document.getElementById("spinBtn");
            const wheel = document.getElementById("wheel");
            
            spinBtn.disabled = true;
            document.getElementById("result").style.display = "none";
            
            // –ü–æ–ª—É—á–∞–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ Drop Pace
            const probs = getProbabilities(userData.dropPace);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–ª–¥–∞—É–Ω –Ω–∞ full access
            if (userData.hasWonFullAccess && userData.fullAccessCooldown) {
                const cooldownEnd = new Date(userData.fullAccessCooldown).getTime();
                if (Date.now() < cooldownEnd) {
                    // –ò—Å–∫–ª—é—á–∞–µ–º full access –∏–∑ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
                    probs.access_7 = 0;
                    probs.access_30 = 0;
                }
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–∑ –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º
            const random = Math.random() * 100;
            let cumulative = 0;
            let selectedType = 'empty';
            
            for (const [type, prob] of Object.entries(probs)) {
                cumulative += prob;
                if (random <= cumulative) {
                    selectedType = type;
                    break;
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–∑
            if (selectedType.startsWith('discount_')) {
                currentPrize = {
                    type: 'discount',
                    value: selectedType.split('_')[1],
                    name: prizeTypes[selectedType].name,
                    name_ru: prizeTypes[selectedType].name_ru
                };
            } else if (selectedType.startsWith('access_')) {
                currentPrize = {
                    type: 'access',
                    value: selectedType.split('_')[1],
                    name: prizeTypes[selectedType].name,
                    name_ru: prizeTypes[selectedType].name_ru
                };
            } else {
                currentPrize = {
                    type: selectedType,
                    value: null,
                    name: prizeTypes[selectedType].name,
                    name_ru: prizeTypes[selectedType].name_ru
                };
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–ª–µ—Å–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            const baseRotation = 1080;
            const prizeIndex = Object.keys(prizeTypes).indexOf(selectedType);
            const segmentAngle = 360 / Object.keys(prizeTypes).length;
            const targetAngle = baseRotation + (prizeIndex * segmentAngle) + (Math.random() * segmentAngle * 0.7);
            
            wheel.style.transition = 'transform 0.1s ease-out';
            wheel.style.transform = 'rotate(0deg)';
            
            setTimeout(() => {
                wheel.style.transition = 'transform 5.5s cubic-bezier(0.2, 0.8, 0.3, 0.99)';
                wheel.style.transform = `rotate(${targetAngle}deg)`;
                
                setTimeout(() => {
                    showPrize();
                    isSpinning = false;
                    spinBtn.disabled = false;
                    userData.lastSpinTime = Date.now();
                }, 5800);
            }, 50);
        }
        
        function showPrize() {
            const t = translations[currentLang];
            const resultDiv = document.getElementById("result");
            const prizeName = document.getElementById("prizeName");
            const prizeDesc = document.getElementById("prizeDesc");
            const claimBtn = document.getElementById("claimBtn");
            const subscribeBtn = document.getElementById("subscribeBtn");
            
            prizeName.textContent = currentLang === 'ru' ? currentPrize.name_ru : currentPrize.name;
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø—Ä–∏–∑–∞
            let desc = '';
            if (currentPrize.type === 'empty') {
                desc = t.emptyMsg;
            } else if (currentPrize.type === 'content') {
                desc = t.contentMsg;
            } else if (currentPrize.type === 'discount') {
                desc = t.discountMsg.replace('{discount}', currentPrize.value);
            } else if (currentPrize.type === 'access') {
                if (currentPrize.value === '7') {
                    desc = t.access7Msg;
                } else {
                    desc = t.access30Msg;
                }
            }
            
            prizeDesc.textContent = desc;
            
            resultDiv.style.display = "block";
            
            // –î–ª—è empty –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É claim
            // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—É–¥–µ—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞
            if (currentPrize.type === 'empty') {
                claimBtn.textContent = t.claimBtn;
                claimBtn.style.display = "block";
                subscribeBtn.style.display = "none";
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ –∫–Ω–æ–ø–∫–∏ - –±–æ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å–∫–∏
                claimBtn.textContent = t.claimBtn;
                claimBtn.style.display = "block";
                // –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ - –ø–æ–∫–∞–∂–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ
            }
        }
        
        function showPendingReward() {
            currentPrize = userData.pendingReward;
            showPrize();
        }
        
        function openSubscribeChannels() {
            CHANNELS.forEach(channel => {
                window.open(`https://t.me/${channel.replace('@', '')}`, '_blank');
            });
            
            // –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            setTimeout(() => {
                checkSubscriptions().then(isSubscribed => {
                    if (isSubscribed) {
                        // –í—ã–¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
                        claimPrize();
                    }
                });
            }, 2000);
        }
        
        function claimPrize() {
            if (!currentPrize) return;
            
            const t = translations[currentLang];
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                const user = Telegram.WebApp.initDataUnsafe.user;
                Telegram.WebApp.sendData(JSON.stringify({
                    action: "wheel_prize",
                    prize: currentPrize,
                    drop_pace: userData.dropPace,
                    user_id: user?.id,
                    username: user?.username,
                    language: currentLang,
                    time: new Date().toISOString()
                }));
                
                // –û—á–∏—â–∞–µ–º pending reward
                userData.pendingReward = null;
                localStorage.removeItem('wheel_user_data');
                
                setTimeout(() => {
                    Telegram.WebApp.close();
                }, 2000);
            } else {
                console.log("Prize claimed:", currentPrize);
                userData.pendingReward = null;
            }
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                
                const userLang = Telegram.WebApp.initDataUnsafe.user?.language_code || 'en';
                const savedLang = localStorage.getItem('wheel_lang') || (userLang === 'ru' ? 'ru' : 'en');
                setLanguage(savedLang);
            } else {
                const savedLang = localStorage.getItem('wheel_lang') || 'en';
                setLanguage(savedLang);
            }
            
            loadUserData();
        });
    </script>
</body>
</html>
